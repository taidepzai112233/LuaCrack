--- deobf by chatgpt

--- Prime Vip – Smooth Orbit AutoFarm (CityNPC Only, Safe MoveTo Version - Smooth Retarget + Auto Aim)
--- Services ---
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualUser = game:GetService("VirtualUser")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local hrp = Character:WaitForChild("HumanoidRootPart")

--- Settings ---
local orbitRadius = 10
local orbitSpeed = 2
local yOffset = 3
local retargetInterval = 1
local attackInterval = 0.3
local noclipEnabled = false
local autoFarmEnabled = false

--- UI ---
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 250, 0, 300)
Frame.Position = UDim2.new(0, 10, 0.5, -150)
Frame.BackgroundTransparency = 0.2
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.Active, Frame.Draggable = true, true

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.Text = "Prime Vip "
Title.TextColor3 = Color3.new(1, 1, 1)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14

--- Slider Function ---
local function createSlider(name, min, max, default, callback, order)
    local label = Instance.new("TextLabel", Frame)
    label.Size = UDim2.new(1, -10, 0, 20)
    label.Position = UDim2.new(0, 5, 0, 40 + (order * 40))
    label.BackgroundTransparency = 1
    label.Text = name .. ": " .. default
    label.TextColor3 = Color3.new(1, 1, 1)
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Font = Enum.Font.Gotham
    label.TextSize = 12

    local slider = Instance.new("TextBox", Frame)
    slider.Size = UDim2.new(1, -10, 0, 20)
    slider.Position = UDim2.new(0, 5, 0, 60 + (order * 40))
    slider.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    slider.Text = tostring(default)
    slider.TextColor3 = Color3.new(1, 1, 1)
    slider.Font = Enum.Font.Gotham
    slider.TextSize = 12

    slider.FocusLost:Connect(function()
        local val = tonumber(slider.Text)
        if val then
            if val < min then val = min elseif val > max then val = max end
            slider.Text = tostring(val)
            label.Text = name .. ": " .. val
            callback(val)
        else
            slider.Text = tostring(default)
        end
    end)
end

createSlider("Khoảng cách cách", 5, orbitRadius, orbitRadius, function(v) orbitRadius = v end, 0)
createSlider("Tần suất quay", 1, 10, orbitSpeed, function(v) orbitSpeed = v end, 1)
createSlider("Y Offset", 0, 10, yOffset, function(v) yOffset = v end, 2)

--- Buttons ---
local noclipButton = Instance.new("TextButton", Frame)
noclipButton.Size = UDim2.new(0, 100, 0, 30)
noclipButton.Position = UDim2.new(0, 5, 0, 200)
noclipButton.Text = "Noclip: OFF"
noclipButton.TextColor3 = Color3.new(1, 1, 1)
noclipButton.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
noclipButton.Font = Enum.Font.GothamBold
noclipButton.TextSize = 14

noclipButton.MouseButton1Click:Connect(function()
    noclipEnabled = not noclipEnabled
    noclipButton.Text = "Noclip: " .. (noclipEnabled and "ON" or "OFF")
    noclipButton.BackgroundColor3 = noclipEnabled and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
end)

local toggleButton = Instance.new("TextButton", Frame)
toggleButton.Size = UDim2.new(0, 100, 0, 30)
toggleButton.Position = UDim2.new(0, 5, 0, 240)
toggleButton.Text = " Tự Farm"
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 14

toggleButton.MouseButton1Click:Connect(function()
    autoFarmEnabled = not autoFarmEnabled
    toggleButton.Text = autoFarmEnabled and "🛠️ Đang Farm" or " Tự Farm"
    toggleButton.BackgroundColor3 = autoFarmEnabled and Color3.fromRGB(0, 100, 0) or Color3.fromRGB(100, 0, 0)
end)

--- User Input ---
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.F then
        autoFarmEnabled = false
        toggleButton.Text = " Tự Farm"
        toggleButton.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
    end
end)

--- Boss Label ---
local BossLabel = Instance.new("TextLabel", Frame)
BossLabel.Size = UDim2.new(1, -10, 0, 20)
BossLabel.Position = UDim2.new(0, 5, 0, 280)
BossLabel.BackgroundTransparency = 1
BossLabel.TextColor3 = Color3.new(1, 1, 1)
BossLabel.Text = "Boss: None"
BossLabel.Font = Enum.Font.Gotham
BossLabel.TextSize = 12

--- Functions ---
local function isAliveModel(model)
    return model and model:FindFirstChild("Humanoid") and model:FindFirstChild("HumanoidRootPart") and model.Humanoid.Health > 0
end

local function getNearestBoss(pos)
    local nearest, dist = nil, math.huge
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj.Name == "CityNPC" and isAliveModel(obj) then
            local root = obj:FindFirstChild("HumanoidRootPart")
            if root then
                local d = (root.Position - pos).Magnitude
                if d < dist then
                    dist = d
                    nearest = obj
                end
            end
        end
    end
    return nearest
end

--- Smooth Move Tween ---
local moveTween = nil
local function moveSmoothlyTo(targetPos)
    if moveTween then moveTween:Cancel() end
    if not Character or not hrp then return end

    local distance = (hrp.Position - targetPos).Magnitude
    local time = math.clamp(distance / 2, 0.5, 3) -- time between 0.5 to 3 seconds

    local tweenInfo = TweenInfo.new(time, Enum.EasingStyle.Linear)
    moveTween = TweenService:Create(hrp, tweenInfo, {CFrame = CFrame.new(targetPos)})
    moveTween:Play()
end

--- Main Loop ---
local currentBoss, angle = nil, 0
local lastAttack, lastRetarget = 0, 0

RunService.Heartbeat:Connect(function(dt)
    if not autoFarmEnabled then return end

    local pos = hrp.Position
    if not currentBoss or not isAliveModel(currentBoss) then
        currentBoss = getNearestBoss(pos)
        angle = 0
    end
    if currentBoss then
        local bossPos = currentBoss.HumanoidRootPart.Position
        angle = (angle + dt * orbitSpeed) % (2 * math.pi)

        local targetX = bossPos.X + orbitRadius * math.cos(angle)
        local targetY = bossPos.Y + yOffset
        local targetZ = bossPos.Z + orbitRadius * math.sin(angle)
        local targetPos = Vector3.new(targetX, targetY, targetZ)

        if noclipEnabled then
            for _, part in pairs(Character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        else
            for _, part in pairs(Character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end

        moveSmoothlyTo(targetPos)

        -- Attack logic placeholder
        lastAttack = lastAttack + dt
        if lastAttack >= attackInterval then
            lastAttack = 0
            -- Trigger attack event here, e.g., fire a RemoteEvent or simulate click
        end
    end
end)
